/* Select */
/* Basic selection with limit */
SELECT * FROM smallzips LIMIT 3;
    city     |  pop  | state 
-------------+-------+-------
 BELCHERTOWN | 10579 | MA
 BARRE       |  4546 | MA
 AGAWAM      | 15338 | MA
(3 rows)

/* Select less fields than exist */
SELECT city FROM smallzips LIMIT 1;
    city     
-------------
 BELCHERTOWN
(1 row)

/* Basic WHERE clause */
SELECT * FROM zips WHERE "state" = 'CO' LIMIT 2;
  city  |  pop  | state 
--------+-------+-------
 ARVADA | 12065 | CO
 ARVADA | 32980 | CO
(2 rows)

/* Nested selection */
SELECT * FROM nested LIMIT 1;
 a | b | c 
---+---+---
 m | n | o
(1 row)

/* less fields than in relation, with one in a WHERE clause */
SELECT city FROM zips WHERE "state" = 'CO' LIMIT 1;
  city  
--------
 ARVADA
(1 row)

SELECT city,pop FROM smallzips WHERE pop % 2 = 1 LIMIT 3;
     city     |  pop  
--------------+-------
 BELCHERTOWN  | 10579
 CUSHMAN      | 36963
 CHESTERFIELD |   177
(3 rows)

/* Test out array usage */
SELECT * FROM zipsloc LIMIT 2;
          loc           
------------------------
 {-72.410953,42.275103}
 {-72.108354,42.409698}
(2 rows)

/* Test out json usage */
SELECT loc->0 AS loc0, locb->1 AS loc1, locb FROM zipsjson LIMIT 2;
    loc0    |   loc1    |          locb           
------------+-----------+-------------------------
 -72.410953 | 42.275103 | [-72.410953, 42.275103]
 -72.108354 | 42.409698 | [-72.108354, 42.409698]
(2 rows)

/* Pushdown regex operators */
SELECT * FROM zips WHERE "state" LIKE 'A%' LIMIT 3;
    city    |  pop  | state 
------------+-------+-------
 ADAMSVILLE | 10616 | AL
 ACMAR      |  6055 | AL
 ADGER      |  3205 | AL
(3 rows)

SELECT * FROM smallzips WHERE "city" !~~ 'B%' LIMIT 3;
  city   |  pop  | state 
---------+-------+-------
 AGAWAM  | 15338 | MA
 CUSHMAN | 36963 | MA
 CHESTER |  1688 | MA
(3 rows)

/* pushdown math operators */
SELECT * FROM smallzips WHERE pop > 1000 AND pop + pop <= 10000 LIMIT 3;
   city    | pop  | state 
-----------+------+-------
 BARRE     | 4546 | MA
 BLANDFORD | 1240 | MA
 BRIMFIELD | 3706 | MA
(3 rows)

/* join zips and zipsjson */
SELECT zips.city AS city, pop, state, loc
       FROM smallzips zips JOIN zipsjson ON zips.city = zipsjson.city
       ORDER BY zips.city LIMIT 3;
   city   |  pop  | state |          loc           
----------+-------+-------+------------------------
 ADAMS    |  9901 | MA    | [-73.117225,42.622319]
 AGAWAM   | 15338 | MA    | [-72.622739,42.070206]
 ASHFIELD |  1535 | MA    | [-72.810998,42.523207]
(3 rows)

/* query for a missing field */
SELECT missing, city FROM zips_missing LIMIT 3;
 missing |    city     
---------+-------------
         | BELCHERTOWN
         | BARRE
         | AGAWAM
(3 rows)

/* query with a bad type */
SELECT loc FROM zips_bad LIMIT 1;
WARNING:  quasar_fdw: column loc is scalar type but got json/array response.
 loc 
-----
    
(1 row)

/* Make quasar_fdw convert a float to integer
 * Quasar converts pop to a float and we convert it back */
SELECT pop, loc0 FROM zips_convert WHERE loc0 < -70 LIMIT 3;
  pop  | loc0 
-------+------
 15338 |     
 36963 |     
  4546 |     
(3 rows)

/* convert string timestamps to timestamp values */
SELECT * FROM commits LIMIT 5;
            ts            |                   sha                    |  author_name  |             author_email              |                                                url                                                | comment_count 
--------------------------+------------------------------------------+---------------+---------------------------------------+---------------------------------------------------------------------------------------------------+---------------
 Thu Jan 29 15:52:37 2015 | b8a2302e6a0659875d03bfe4988c000f2ed027a0 | Greg Pfeil    | greg@technomadic.org                  | https://api.github.com/repos/slamdata/slamengine/commits/b8a2302e6a0659875d03bfe4988c000f2ed027a0 |             0
 Thu Jan 29 00:23:14 2015 | 18164870e8803e5885a88f8dfd53b82c80721503 | Moss Prescott | moss@theprescotts.com                 | https://api.github.com/repos/slamdata/slamengine/commits/18164870e8803e5885a88f8dfd53b82c80721503 |             0
 Wed Jan 28 17:06:29 2015 | b29d8f254e5df2c4d1792f077625924cd1fde2db | Moss Prescott | moss@theprescotts.com                 | https://api.github.com/repos/slamdata/slamengine/commits/b29d8f254e5df2c4d1792f077625924cd1fde2db |             0
 Wed Jan 28 16:20:27 2015 | 53d2e5684d9403194dff1cc63423c2590038d1c0 | Moss Prescott | mossprescott@users.noreply.github.com | https://api.github.com/repos/slamdata/slamengine/commits/53d2e5684d9403194dff1cc63423c2590038d1c0 |             0
 Wed Jan 28 16:27:52 2015 | 3d44ce48fc0670aaf39ba1acd0e1c161f14cc2d6 | Greg Pfeil    | greg@technomadic.org                  | https://api.github.com/repos/slamdata/slamengine/commits/3d44ce48fc0670aaf39ba1acd0e1c161f14cc2d6 |             0
(5 rows)

/* BUT we shouldn't push down comparisons on dates because the underlying data is string */
SELECT * FROM commits WHERE ts = timestamp 'Thu Jan 29 15:52:37 2015';
            ts            |                   sha                    | author_name |     author_email     |                                                url                                                | comment_count 
--------------------------+------------------------------------------+-------------+----------------------+---------------------------------------------------------------------------------------------------+---------------
 Thu Jan 29 15:52:37 2015 | b8a2302e6a0659875d03bfe4988c000f2ed027a0 | Greg Pfeil  | greg@technomadic.org | https://api.github.com/repos/slamdata/slamengine/commits/b8a2302e6a0659875d03bfe4988c000f2ed027a0 |             0
(1 row)

/* convert year as string to integers floats and dates */
SELECT yr, yearint, yearfloat FROM olympics WHERE "yr" = '1924' LIMIT 3;
  yr  | yearint | yearfloat 
------+---------+-----------
 1924 |    1924 |      1924
 1924 |    1924 |      1924
 1924 |    1924 |      1924
(3 rows)

