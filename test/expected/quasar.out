/* Select */
/* Basic selection with limit */
SELECT * FROM smallzips LIMIT 3;
    city     |  pop  | state 
-------------+-------+-------
 BELCHERTOWN | 10579 | MA
 BARRE       |  4546 | MA
 AGAWAM      | 15338 | MA
(3 rows)

/* Select less fields than exist */
SELECT city FROM smallzips LIMIT 1;
    city     
-------------
 BELCHERTOWN
(1 row)

/* Basic WHERE clause */
SELECT * FROM zips WHERE "state" = 'CO' LIMIT 2;
  city  |  pop  | state 
--------+-------+-------
 ARVADA | 12065 | CO
 ARVADA | 32980 | CO
(2 rows)

/* Nested selection */
SELECT * FROM nested LIMIT 1;
 a | b | c 
---+---+---
 m | n | o
(1 row)

/* less fields than in relation, with one in a WHERE clause */
SELECT city FROM zips WHERE "state" = 'CO' LIMIT 1;
  city  
--------
 ARVADA
(1 row)

SELECT city,pop FROM smallzips WHERE pop % 2 = 1 LIMIT 3;
     city     |  pop  
--------------+-------
 BELCHERTOWN  | 10579
 CUSHMAN      | 36963
 CHESTERFIELD |   177
(3 rows)

/* Test out array usage */
SELECT * FROM zipsloc LIMIT 2;
          loc           
------------------------
 {-72.410953,42.275103}
 {-72.108354,42.409698}
(2 rows)

/* Test out json usage */
SELECT loc->0 AS loc0, locb->1 AS loc1, locb FROM zipsjson LIMIT 2;
    loc0    |   loc1    |          locb           
------------+-----------+-------------------------
 -72.410953 | 42.275103 | [-72.410953, 42.275103]
 -72.108354 | 42.409698 | [-72.108354, 42.409698]
(2 rows)

/* Pushdown regex operators */
SELECT * FROM zips WHERE "state" LIKE 'A%' LIMIT 3;
    city    |  pop  | state 
------------+-------+-------
 ADAMSVILLE | 10616 | AL
 ACMAR      |  6055 | AL
 ADGER      |  3205 | AL
(3 rows)

SELECT * FROM smallzips WHERE "city" !~~ 'B%' LIMIT 3;
  city   |  pop  | state 
---------+-------+-------
 AGAWAM  | 15338 | MA
 CUSHMAN | 36963 | MA
 CHESTER |  1688 | MA
(3 rows)

/* pushdown math operators */
SELECT * FROM smallzips WHERE pop > 1000 AND pop + pop <= 10000 LIMIT 3;
   city    | pop  | state 
-----------+------+-------
 BARRE     | 4546 | MA
 BLANDFORD | 1240 | MA
 BRIMFIELD | 3706 | MA
(3 rows)

/* join zips and zipsjson */
SELECT zips.city AS city, pop, state, loc
       FROM smallzips zips JOIN zipsjson ON zips.city = zipsjson.city
       ORDER BY zips.city LIMIT 3;
   city   |  pop  | state |          loc           
----------+-------+-------+------------------------
 ADAMS    |  9901 | MA    | [-73.117225,42.622319]
 AGAWAM   | 15338 | MA    | [-72.622739,42.070206]
 ASHFIELD |  1535 | MA    | [-72.810998,42.523207]
(3 rows)

/* query for a missing field */
SELECT missing, city FROM zips_missing LIMIT 3;
 missing |    city     
---------+-------------
         | BELCHERTOWN
         | BARRE
         | AGAWAM
(3 rows)

/* query with a bad type */
SELECT loc FROM zips_bad LIMIT 1;
 loc 
-----
    
(1 row)

/* Make quasar_fdw convert a float to integer
 * Quasar converts pop to a float and we convert it back */
SELECT pop, loc0 FROM zips_convert WHERE loc0 < -70 LIMIT 3;
  pop  |    loc0    
-------+------------
 15338 | -72.622739
 36963 |  -72.51565
  4546 | -72.108354
(3 rows)

